<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>İmtahan — Laboratoriya Kursu</title>
  <style>
    body { font-family:Arial, sans-serif; background:#f6f8fb; margin:0; padding:20px; user-select:none; }
    .container { max-width:900px; margin:0 auto; }
    .exam-card { background:#fff; padding:18px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:15px; }
    .exam-qtext { font-size:18px; font-weight:600; margin-bottom:10px; }
    .exam-options { display:flex; flex-direction:column; gap:6px; }
    .exam-opt { padding:10px; border:1px solid #ccc; border-radius:8px; cursor:pointer; background:#fafafa; }
    .exam-opt.selected { background:#eef6ff; border-color:#2b6cb0; }
    .exam-opt.correct { background:#4caf50; color:#fff; }
    .exam-opt.wrong { background:#e53935; color:#fff; }
    .exam-controls { display:flex; justify-content:space-between; align-items:center; margin-top:12px; }
    .exam-result { text-align:center; font-size:18px; padding:20px; }
    .btn { padding:8px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
    .btn.prev { background:#2b6cb0; color:#fff; }
    .btn.next { background:#ffdd57; color:#111; }
  </style>
</head>
<body oncontextmenu="return false">
<div class="container">
  <h2 style="text-align:center;">🧪 İmtahan</h2>
  <div id="examArea"></div>
</div>

<script>
const EXAM_COUNT = 60;
const PER_PAGE = 10;
const PASS_SCORE = 40;
let examQuestions = [];
let examAnswers = {};
let currentPage = 0;

async function loadExamQuestions(){
  try {
    const res = await fetch("https://winter-darkness-2c14.herseydenbiraz4k.workers.dev");
    if(!res.ok) throw new Error("Suallar tapılmadı");
    const all = await res.json();
    examQuestions = pickRandomQuestions(all, EXAM_COUNT);
    renderPage(0);
  } catch(err){
    document.getElementById("examArea").innerHTML = "Xəta: " + err.message;
  }
}

function pickRandomQuestions(arr,n){
  const a=arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a.slice(0,Math.min(n,a.length));
}

function removeNumberPrefix(text){
  return text.replace(/^\d+\.\s*/, "");
}

function renderPage(page){
  currentPage=page;
  const area=document.getElementById("examArea");
  area.innerHTML="";

  const start=page*PER_PAGE;
  const end=Math.min(start+PER_PAGE,examQuestions.length);
  
  for(let i=start;i<end;i++){
    const q=examQuestions[i];
    const card=document.createElement("div");
    card.className="exam-card";

    const qtext=document.createElement("div");
    qtext.className="exam-qtext";
    qtext.textContent=`${i+1}. ${removeNumberPrefix(q.text)}`;
    card.appendChild(qtext);

    const opts=document.createElement("div");
    opts.className="exam-options";
    q.options.forEach((txt,idx)=>{
      const opt=document.createElement("div");
      opt.className="exam-opt";
      if(examAnswers[i]===idx) opt.classList.add("selected");
      opt.textContent=txt;
      opt.onclick=()=>{
        examAnswers[i]=idx;
        [...opts.children].forEach(c=>c.classList.remove("selected"));
        opt.classList.add("selected");
      };
      opts.appendChild(opt);
    });
    card.appendChild(opts);
    area.appendChild(card);
  }

  const controls=document.createElement("div");
  controls.className="exam-controls";

  const prev=document.createElement("button");
  prev.className="btn prev";
  prev.textContent="Əvvəlki";
  prev.disabled=(page===0);
  prev.onclick=()=>{ renderPage(page-1); window.scrollTo({top:0,behavior:"smooth"}); };

  const next=document.createElement("button");
  next.className="btn next";
  next.textContent=(end===examQuestions.length)?"Bitir və Yoxla":"Sonrakı";
  next.onclick=()=>{
    if(end===examQuestions.length){ finishExam(); }
    else { renderPage(page+1); window.scrollTo({top:0,behavior:"smooth"}); }
  };

  controls.appendChild(prev);
  controls.appendChild(next);
  area.appendChild(controls);
}

function finishExam(){
  let correct=0;
  const area=document.getElementById("examArea");
  area.innerHTML="";

  examQuestions.forEach((q,i)=>{
    const card=document.createElement("div");
    card.className="exam-card";

    const qtext=document.createElement("div");
    qtext.className="exam-qtext";
    qtext.textContent=`${i+1}. ${removeNumberPrefix(q.text)}`;
    card.appendChild(qtext);

    const opts=document.createElement("div");
    opts.className="exam-options";

    let ansIndex = (typeof q.answer === "number") ? q.answer-1 : 0;

    q.options.forEach((txt,idx)=>{
      const opt=document.createElement("div");
      opt.className="exam-opt";
      opt.textContent=txt;

      if(idx===ansIndex) opt.classList.add("correct");
      if(examAnswers[i]===idx && idx!==ansIndex) opt.classList.add("wrong");

      opts.appendChild(opt);
    });

    if(examAnswers[i]===ansIndex) correct++;
    card.appendChild(opts);
    area.appendChild(card);
  });

  const passed=(correct>=PASS_SCORE);
  const result=document.createElement("div");
  result.className="exam-card exam-result";
  result.innerHTML=`
    <div>İmtahan tamamlandı ✅</div>
    <div>Xalınız: <strong>${correct}</strong> / ${examQuestions.length}</div>
    <div style="color:${passed?'green':'red'};margin-top:8px;">
      ${passed? 'Keçdiniz 🎉':'Keçmədiniz ❌'}
    </div>
    <button class="btn prev" style="margin-top:12px;" onclick="location.href='index.html'">Quiz-ə qayıt</button>
  `;
  area.prepend(result);
  window.scrollTo({top:0,behavior:"smooth"});
}

loadExamQuestions();
</script>
</body>
</html>
